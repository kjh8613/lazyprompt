{{ define "main" }}
<header class="profile-header">
    <div class="profile-card">
        <!-- Logo Removed as per user request -->
        <h1>{{ .Site.Title }}</h1>
        <p class="subtitle">{{ .Site.Params.profileMode.subtitle }}</p>
    </div>
</header>
<main class="post-list">

    <!-- Search Hero Section -->
    <div class="search-hero">
        <h2>Find the Perfect Prompt</h2>
        <div class="search-container">
            <input type="text" id="globalSearchInput"
                placeholder="What are you building today? (e.g. Marketing, Code...)">
            <button class="search-icon-btn" id="globalSearchBtn">üîç</button>
        </div>
    </div>

    <!-- AdSense Unit -->
    <div style="text-align:center; margin-bottom: 40px;">
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6793290562583440"
            data-ad-slot="9236420639" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <h2 class="section-title">Latest Updates</h2>
    <div class="grid" id="postGrid">
        {{ $paginator := .Paginate (where .Site.RegularPages "Type" "posts") }}
        {{ range $paginator.Pages }}
        <article class="card">
            <a href="{{ .RelPermalink }}">
                {{ with .Params.cover.image }}
                <div class="card-image" style="background-image: url('{{ . }}');"></div>
                {{ end }}
                <div class="card-content">
                    <h3>{{ .Title }}</h3>
                    <p>{{ .Summary | truncate 100 }}</p>
                    <span class="date">{{ .Date.Format "Jan 02, 2006" }}</span>
                </div>
            </a>
        </article>
        {{ end }}
    </div>

    <!-- Pagination Controls -->
    {{ if gt $paginator.TotalPages 1 }}
    <div class="pagination">
        {{ if $paginator.HasPrev }}
        <a href="{{ $paginator.Prev.URL }}" class="page-link prev">‚Üê Prev</a>
        {{ end }}

        <span class="page-info">Page {{ $paginator.PageNumber }} of {{ $paginator.TotalPages }}</span>

        {{ if $paginator.HasNext }}
        <a href="{{ $paginator.Next.URL }}" class="page-link next">Next ‚Üí</a>
        {{ end }}
    </div>
    {{ end }}

    <script>
        // Inline search for homepage
        (function () {
            const searchInput = document.getElementById('globalSearchInput');
            const searchBtn = document.getElementById('globalSearchBtn');
            const postGrid = document.querySelector('.grid');

            if (!searchInput || !postGrid) return;

            const initialHTML = postGrid.innerHTML;
            const initialPagination = document.querySelector('.pagination');

            let posts = [];

            fetch('/index.json')
                .then(res => res.json())
                .then(data => {
                    posts = data;
                    console.log('Loaded', posts.length, 'posts');
                })
                .catch(e => console.error('Error:', e));

            function performSearch() {
                const query = searchInput.value.trim().toLowerCase();

                if (query.length === 0) {
                    postGrid.innerHTML = initialHTML;
                    if (initialPagination) initialPagination.style.display = 'flex';
                    return;
                }

                if (initialPagination) initialPagination.style.display = 'none';

                const results = posts.filter(p =>
                    p.title.toLowerCase().includes(query) ||
                    p.summary.toLowerCase().includes(query)
                );

                if (results.length === 0) {
                    postGrid.innerHTML = '<p style="text-align:center;color:#777;">No results found</p>';
                } else {
                    postGrid.innerHTML = results.map(p => `
                    <article class="card">
                        <a href="${p.permalink}">
                            ${p.image ? `<div class="card-image" style="background-image: url('${p.image}');"></div>` : ''}
                            <div class="card-content">
                                <h3>${p.title}</h3>
                                <p>${p.summary}</p>
                                <span class="date">${p.date}</span>
                            </div>
                        </a>
                    </article>
                `).join('');
                }
            }

            searchInput.addEventListener('input', performSearch);
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') performSearch();
            });
            if (searchBtn) {
                searchBtn.addEventListener('click', performSearch);
            }
        })();
    </script>
</main>
{{ end }}