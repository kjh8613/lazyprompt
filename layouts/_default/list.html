{{ define "main" }}
<!-- Mobile Sidebar Toggle -->
<button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Menu">‚ò∞</button>

<div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <a href="/" class="sidebar-logo">{{ .Site.Title }}</a>
        <p class="sidebar-subtitle">{{ .Site.Params.profileMode.subtitle }}</p>

        <!-- Home Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-section-title">Navigation</h3>
            <ul class="sidebar-nav">
                <li>
                    <a href="/">
                        <span>üè† Home</span>
                        <span class="sidebar-count">{{ len .Site.RegularPages }}</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Categories Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-section-title">Categories</h3>
            <ul class="sidebar-nav">
                {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
                <li>
                    <a href="/categories/{{ $name | urlize }}/" {{ if eq $.Title ($name | humanize) }}class="active" {{
                        end }}>
                        <span>{{ $name | humanize }}</span>
                        <span class="sidebar-count">{{ $taxonomy.Count }}</span>
                    </a>
                </li>
                {{ end }}
            </ul>
        </div>
    </aside>

    <!-- Main Content Wrapper -->
    <div class="main-with-sidebar">
        <!-- Header -->
        <header class="site-header">
            <div class="header-container">
                <a href="/" class="site-logo">{{ .Site.Title }}</a>
                <nav class="header-nav">
                    {{ range .Site.Menus.main }}
                    <a href="{{ .URL }}" class="nav-link">{{ .Name }}</a>
                    {{ end }}
                </nav>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-container">
                <div class="hero-badge">
                    <span>üìÅ</span>
                    <span>{{ .Title }} Category</span>
                </div>
                <h1 class="hero-title">{{ .Title }}</h1>
                <p class="hero-subtitle">Explore {{ len .Pages }} curated prompts in the {{ .Title }} category</p>
            </div>
        </section>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-wrapper">
                <input type="text" id="categorySearchInput" class="search-input" placeholder="Search in {{ .Title }}..."
                    autocomplete="off" data-category="{{ .Title }}">
                <span class="search-icon">üîç</span>
            </div>
            <div id="searchStatus" class="search-status"></div>
        </div>

        <!-- AdSense -->
        <div style="text-align:center; margin: 2rem 0;">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6793290562583440"
                data-ad-slot="9236420639" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="section-header">
                <h2 class="section-title" id="sectionTitle">{{ .Title }} Prompts</h2>
                <span class="result-count" id="resultCount">{{ len .Pages }} total</span>
            </div>

            <!-- Posts Grid -->
            <div class="posts-grid" id="postsGrid">
                {{ $paginator := .Paginate .Pages }}
                {{ range $paginator.Pages }}
                <article class="post-card">
                    <a href="{{ .RelPermalink }}">
                        {{ with .Params.cover.image }}
                        <div class="post-thumbnail" style="background-image: url('{{ . }}');"></div>
                        {{ else }}
                        <div class="post-thumbnail"></div>
                        {{ end }}
                        <div class="post-content">
                            <h3 class="post-title">{{ .Title }}</h3>
                            <p class="post-summary">{{ .Summary | truncate 150 }}</p>
                            <div class="post-meta">
                                <span class="post-date">{{ .Date.Format "Jan 02, 2006" }}</span>
                                <span class="post-arrow">‚Üí</span>
                            </div>
                        </div>
                    </a>
                </article>
                {{ end }}
            </div>

            <!-- Pagination -->
            {{ if gt $paginator.TotalPages 1 }}
            <div class="pagination" id="pagination">
                {{ if $paginator.HasPrev }}
                <a href="{{ $paginator.Prev.URL }}" class="page-link">‚Üê Previous</a>
                {{ end }}
                <span class="page-info">Page {{ $paginator.PageNumber }} of {{ $paginator.TotalPages }}</span>
                {{ if $paginator.HasNext }}
                <a href="{{ $paginator.Next.URL }}" class="page-link">Next ‚Üí</a>
                {{ end }}
            </div>
            {{ end }}
        </main>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-content">
                <p>&copy; {{ now.Year }} {{ .Site.Title }}. Designed for Builders & Creators.</p>
            </div>
        </footer>
    </div>
</div>

<!-- Category-Filtered Search Script -->
<script>
    (function () {
        'use strict';

        // DOM Elements
        const searchInput = document.getElementById('categorySearchInput');
        const postsGrid = document.getElementById('postsGrid');
        const pagination = document.getElementById('pagination');
        const searchStatus = document.getElementById('searchStatus');
        const sectionTitle = document.getElementById('sectionTitle');
        const resultCount = document.getElementById('resultCount');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');

        if (!searchInput || !postsGrid) return;

        // Mobile sidebar toggle
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', function () {
                sidebar.classList.toggle('open');
            });

            document.addEventListener('click', function (e) {
                if (window.innerWidth <= 968 &&
                    !sidebar.contains(e.target) &&
                    !sidebarToggle.contains(e.target) &&
                    sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                }
            });
        }

        // Get current category from data attribute
        const currentCategory = searchInput.dataset.category;

        // Store initial state
        const initialHTML = postsGrid.innerHTML;
        const initialPagination = pagination ? pagination.outerHTML : '';
        let categoryPosts = [];

        // Load search index
        searchStatus.textContent = 'Loading search index...';
        searchStatus.className = 'search-status';

        fetch('/index.json')
            .then(response => {
                if (!response.ok) throw new Error('Failed to load search index');
                return response.json();
            })
            .then(data => {
                // Filter posts by current category
                categoryPosts = data.filter(post => {
                    if (!post.categories) return false;
                    return post.categories.some(cat =>
                        cat.toLowerCase() === currentCategory.toLowerCase()
                    );
                });

                searchStatus.textContent = `‚úì ${categoryPosts.length} prompts in ${currentCategory}`;
                searchStatus.className = 'search-status success';
                setTimeout(() => searchStatus.textContent = '', 3000);
            })
            .catch(error => {
                console.error('Search index error:', error);
                searchStatus.textContent = '‚úó Search unavailable';
                searchStatus.className = 'search-status error';
            });

        // Search function (category-filtered)
        function performSearch() {
            const query = searchInput.value.trim().toLowerCase();

            if (query.length === 0) {
                postsGrid.innerHTML = initialHTML;
                if (pagination) {
                    const existingPagination = document.getElementById('pagination');
                    if (existingPagination) existingPagination.remove();
                    if (initialPagination) postsGrid.insertAdjacentHTML('afterend', initialPagination);
                }
                sectionTitle.textContent = `${currentCategory} Prompts`;
                resultCount.textContent = `${categoryPosts.length} total`;
                return;
            }

            const existingPagination = document.getElementById('pagination');
            if (existingPagination) existingPagination.style.display = 'none';

            const results = categoryPosts.filter(post => {
                const searchableText = [
                    post.title,
                    post.summary,
                    (post.tags || []).join(' ')
                ].join(' ').toLowerCase();

                return searchableText.includes(query);
            });

            sectionTitle.textContent = `Search Results in ${currentCategory}`;
            resultCount.textContent = `${results.length} result${results.length !== 1 ? 's' : ''}`;

            if (results.length === 0) {
                postsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üîç</div>
                        <h3 class="empty-title">No prompts found in ${currentCategory}</h3>
                        <p class="empty-text">Try different keywords or browse all ${currentCategory} prompts</p>
                    </div>
                `;
            } else {
                postsGrid.innerHTML = results.map(post => `
                    <article class="post-card">
                        <a href="${post.permalink}">
                            ${post.image ?
                        `<div class="post-thumbnail" style="background-image: url('${post.image}');"></div>` :
                        `<div class="post-thumbnail"></div>`
                    }
                            <div class="post-content">
                                <h3 class="post-title">${escapeHtml(post.title)}</h3>
                                <p class="post-summary">${escapeHtml(truncate(post.summary, 150))}</p>
                                <div class="post-meta">
                                    <span class="post-date">${post.date}</span>
                                    <span class="post-arrow">‚Üí</span>
                                </div>
                            </div>
                        </a>
                    </article>
                `).join('');
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function truncate(text, length) {
            if (text.length <= length) return text;
            return text.substr(0, length) + '...';
        }

        let searchTimeout;
        searchInput.addEventListener('input', function () {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(performSearch, 300);
        });

        searchInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                clearTimeout(searchTimeout);
                performSearch();
            }
        });
    })();
</script>

<!-- AdSense Script -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6793290562583440"
    crossorigin="anonymous"></script>
{{ end }}